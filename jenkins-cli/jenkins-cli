#!/bin/bash

if [ -f /etc/jenkins-cli/cli.conf ]; then
    source /etc/jenkins-cli/cli.conf
fi

USER=${JENKINS_USER:-admin}
APITOKEN=${JENKINS_PASSWORD:-$(test -f /var/lib/jenkins/secrets/initialAdminPassword && cat /var/lib/jenkins/secrets/initialAdminPassword)}
URL=${SERVER_URL:-http://localhost:8080}

if [ -n "${USER}" -a -n "${APITOKEN}" ]; then
    java -jar /usr/share/jenkins-cli/cli.jar -webSocket -auth ${USER}:${APITOKEN} -s ${URL} $@
else
    java -jar /usr/share/jenkins-cli/cli.jar -webSocket -s ${URL} $@
fi
